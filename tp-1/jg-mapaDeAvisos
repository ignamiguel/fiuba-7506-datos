{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "%matplotlib inline\n",
    "from bokeh.plotting import figure, show\n",
    "import string as string\n",
    "import datetime as datetime\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "from geopy.geocoders import Nominatim\n",
    "from geopy.exc import GeocoderTimedOut\n",
    "geolocator = Nominatim()\n",
    "from bokeh.io import output_file, output_notebook\n",
    "from bokeh.models import (\n",
    "  GMapPlot, GMapOptions, ColumnDataSource, Circle, LogColorMapper, BasicTicker, ColorBar,\n",
    "    DataRange1d, Range1d, PanTool, WheelZoomTool, HoverTool )\n",
    "\n",
    "from bokeh.core.properties import JSON\n",
    "from bokeh.core.properties import String\n",
    "import json\n",
    "\n",
    "from bokeh.models.mappers import ColorMapper, LinearColorMapper\n",
    "from bokeh.palettes import Viridis5\n",
    "\n",
    "\n",
    "\n",
    "\n",
    "plt.style.use('default') ### haciendo los graficos un poco mas bonitos xD\n",
    "plt.rcParams['figure.figsize'] = (15, 5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "avisos = pd.read_csv('/home/pcsor/facu/datos_navent_fiuba/avisos.csv', sep=',', encoding='utf-8', low_memory=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "estilo=[\n",
    "    {\n",
    "        \"featureType\": \"all\",\n",
    "        \"elementType\": \"all\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"visibility\": \"on\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"all\",\n",
    "        \"elementType\": \"labels\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"visibility\": \"on\"\n",
    "            },\n",
    "            {\n",
    "                \"saturation\": \"-100\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"all\",\n",
    "        \"elementType\": \"labels.text.fill\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"saturation\": 100\n",
    "            },\n",
    "            {\n",
    "                \"color\": \"#24282b\"\n",
    "            },\n",
    "            {\n",
    "                \"lightness\": 60\n",
    "            },\n",
    "            {\n",
    "                \"visibility\": \"on\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"all\",\n",
    "        \"elementType\": \"labels.text.stroke\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"visibility\": \"off\"\n",
    "            },\n",
    "            {\n",
    "                \"color\": \"#24282b\"\n",
    "            },\n",
    "            {\n",
    "                \"lightness\": 50\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"all\",\n",
    "        \"elementType\": \"labels.icon\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"visibility\": \"off\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"administrative\",\n",
    "        \"elementType\": \"geometry.fill\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#000000\"\n",
    "            },\n",
    "            {\n",
    "                \"lightness\": 20\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"administrative\",\n",
    "        \"elementType\": \"geometry.stroke\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#000000\"\n",
    "            },\n",
    "            {\n",
    "                \"lightness\": 17\n",
    "            },\n",
    "            {\n",
    "                \"weight\": 1.2\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"landscape\",\n",
    "        \"elementType\": \"geometry\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#000000\"\n",
    "            },\n",
    "            {\n",
    "                \"lightness\": 20\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"landscape\",\n",
    "        \"elementType\": \"geometry.fill\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#4d6059\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"landscape\",\n",
    "        \"elementType\": \"geometry.stroke\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#4d6059\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"landscape.natural\",\n",
    "        \"elementType\": \"geometry.fill\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#4d6059\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"poi\",\n",
    "        \"elementType\": \"geometry\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"lightness\": 21\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"poi\",\n",
    "        \"elementType\": \"geometry.fill\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#4d6059\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"poi\",\n",
    "        \"elementType\": \"geometry.stroke\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#4d6059\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"road\",\n",
    "        \"elementType\": \"geometry\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"visibility\": \"on\"\n",
    "            },\n",
    "            {\n",
    "                \"color\": \"#7f8d89\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"road\",\n",
    "        \"elementType\": \"geometry.fill\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#7f8d89\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"road.highway\",\n",
    "        \"elementType\": \"geometry.fill\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#7f8d89\"\n",
    "            },\n",
    "            {\n",
    "                \"lightness\": 17\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"road.highway\",\n",
    "        \"elementType\": \"geometry.stroke\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#7f8d89\"\n",
    "            },\n",
    "            {\n",
    "                \"lightness\": 29\n",
    "            },\n",
    "            {\n",
    "                \"weight\": 0.2\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"road.arterial\",\n",
    "        \"elementType\": \"geometry\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#000000\"\n",
    "            },\n",
    "            {\n",
    "                \"lightness\": 18\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"road.arterial\",\n",
    "        \"elementType\": \"geometry.fill\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#7f8d89\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"road.arterial\",\n",
    "        \"elementType\": \"geometry.stroke\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#7f8d89\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"road.local\",\n",
    "        \"elementType\": \"geometry\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#000000\"\n",
    "            },\n",
    "            {\n",
    "                \"lightness\": 16\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"road.local\",\n",
    "        \"elementType\": \"geometry.fill\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#7f8d89\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"road.local\",\n",
    "        \"elementType\": \"geometry.stroke\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#7f8d89\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"transit\",\n",
    "        \"elementType\": \"geometry\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#000000\"\n",
    "            },\n",
    "            {\n",
    "                \"lightness\": 19\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"water\",\n",
    "        \"elementType\": \"all\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#2b3638\"\n",
    "            },\n",
    "            {\n",
    "                \"visibility\": \"on\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"water\",\n",
    "        \"elementType\": \"geometry\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#2b3638\"\n",
    "            },\n",
    "            {\n",
    "                \"lightness\": 17\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"water\",\n",
    "        \"elementType\": \"geometry.fill\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#24282b\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"water\",\n",
    "        \"elementType\": \"geometry.stroke\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"color\": \"#24282b\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"water\",\n",
    "        \"elementType\": \"labels\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"visibility\": \"off\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"water\",\n",
    "        \"elementType\": \"labels.text\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"visibility\": \"off\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"water\",\n",
    "        \"elementType\": \"labels.text.fill\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"visibility\": \"off\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"water\",\n",
    "        \"elementType\": \"labels.text.stroke\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"visibility\": \"off\"\n",
    "            }\n",
    "        ]\n",
    "    },\n",
    "    {\n",
    "        \"featureType\": \"water\",\n",
    "        \"elementType\": \"labels.icon\",\n",
    "        \"stylers\": [\n",
    "            {\n",
    "                \"visibility\": \"off\"\n",
    "            }\n",
    "        ]\n",
    "    }\n",
    "]\n",
    "estilo = json.dumps(estilo)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "map_options = GMapOptions(lat=-34.606719800, lng=-58.435779700, map_type=\"roadmap\", zoom=12 ,  styles = estilo )\n",
    "plot = GMapPlot(\n",
    "    x_range=Range1d(), y_range=Range1d(), map_options=map_options\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "plot.title.text = \"Mapa de los avisos\"\n",
    "\n",
    "# For GMaps to function, Google requires you obtain and enable an API key:\n",
    "#\n",
    "#     https://developers.google.com/maps/documentation/javascript/get-api-key\n",
    "#\n",
    "# Replace the value below with your personal API key:\n",
    "plot.api_key = \"AIzaSyBejhbN4aI3s376JNh_yNMO_VC0uGs5Nk4\"\n",
    "\n",
    "source = ColumnDataSource(\n",
    "    data=dict(\n",
    "        lat=avisos.lat.tolist(),\n",
    "        lon=avisos.long.tolist(),\n",
    "))\n",
    "circle = Circle(x=\"lon\", y=\"lat\",size=6, line_width = 0.01,  fill_color='#ff8c66', fill_alpha=0.6)\n",
    "\n",
    "plot.add_glyph(source, circle)\n",
    "\n",
    "plot.add_tools(WheelZoomTool(), PanTool())\n",
    "output_file(\"gmap_plot.html\")\n",
    "output_notebook()\n",
    "\n",
    "show(plot)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
